# Тестирование БД ClickHlouse и Vertica

Производится тестирование двух баз данных на удовлетворение требований к записи и чтению данных.

### Имеющиеся тесты:
1. Тестирование времени вставки больших данных из csv-файла;
2. Тестирование среднего времени получения количества записей в таблице;
3. Тестирование среднего времени получения фильмов для конкретного пользователя;
4. Тестирование среднего времени получения пользователей для конкретного фильма;
5. Тестирование среднего времени записи в таблциу по чанкам.

### Для запуска тестов неоходимо:
1. Запустить контенеры, перейдя в директорию `/ugc_sprint_1/storages_research/docker_settings`
и запустив команду `docker-compose -f docker-compose.yml up -d --build`;
2. Сформировать тестовые данные, запустив модуль `/ugc_sprint_1/storages_research/generate_csv_data.py`
   (при необходимости можно изменить количесвто данных в модуле);
3. Запустить модуль `/ugc_sprint_1/storages_research/main.py`
(тут последовательно запустятся тесты для каждой БД по отдельности);

### Для запуска тестов по mongodb неоходимо последовательно выполнить следующие действия:
1. Перейти в директорию `/ugc_sprint_1/storages_research/docker_settings`
2. В терминале выполнить ```docker-compose -f docker-compose.mongo.yml down -v```
3. В терминале выполнить ```docker-compose -f docker-compose.mongo.yml up -d --build```
4. Настройка кластера для mongodb
   - ```docker exec -it mongocfg1 bash -c 'mongosh < /scripts/init-configserver.js'```
   - ```docker exec -it mongors1n1 bash -c 'mongosh < /scripts/init-shard01.js'```
   - ```docker exec -it mongors2n1 bash -c 'mongosh < /scripts/init-shard02.js'```
   - ```docker exec -it mongos1 bash -c 'mongosh < /scripts/init-router.js'```
5. Запустить модуль `/ugc_sprint_1/storages_research/mongo_test.py`

### Результаты тестов:

#### ClickHouse:
1) Тест: Запись в хранилище из CSV файла. Время выполнения: 327.2819368839264 секунд. (10_000_000 строк)
2) Тест: Тестирование среднего времени получения количества записей в таблице. Количество тестов: 50. Среднее время выполнения: 0.07132812023162842 секунд.
3) Тест: Тестирование среднего времени получения фильмов для конкретного пользователя. Количество тестов: 50. Среднее время выполнения: 0.06159318923950195 секунд.
4) Тест: Тестирование среднего времени получения пользователей для конкретного фильма. Количество тестов: 50. Среднее время выполнения: 0.07170447826385498 секунд.
5) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1. Количество тестов: 50. Среднее время выполнения: 0.0326569414138794 секунд.
6) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 20. Количество тестов: 50. Среднее время выполнения: 0.03846747875213623 секунд.
7) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 500. Количество тестов: 50. Среднее время выполнения: 0.05712508201599121 секунд.
8) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1000. Количество тестов: 50. Среднее время выполнения: 0.090653395652771 секунд.
#### Vertica:
1) Тест: Запись в хранилище из CSV файла. Время выполнения: 555.8045220375061 секунд. (10_000_000 строк)
2) Тест: Тестирование среднего времени получения количества записей в таблице. Количество тестов: 50. Среднее время выполнения: 0.09725379467010498 секунд.
3) Тест: Тестирование среднего времени получения фильмов для конкретного пользователя. Количество тестов: 50. Среднее время выполнения: 0.03726672649383545 секунд.
4) Тест: Тестирование среднего времени получения пользователей для конкретного фильма. Количество тестов: 50. Среднее время выполнения: 0.2311284351348877 секунд.
5) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1. Количество тестов: 50. Среднее время выполнения: 0.0653685998916626 секунд.
6) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 20. Количество тестов: 50. Среднее время выполнения: 0.1429066276550293 секунд.
7) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 500. Количество тестов: 50. Среднее время выполнения: 3.4251347303390505 секунд.
8) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1000. Количество тестов: 50. Среднее время выполнения: 8.040289573669433 секунд.
### MongoDB:
1) Тест: Тестирование среднего времени получения количества записей в таблице. Количество тестов: 50. Среднее время выполнения: 0.3328544092178345 секунд.
2) Тест: Тестирование среднего времени получения фильмов по паре идентификаторов. Количество тестов: 50. Среднее время выполнения: 0.0011374855041503906 секунд.
3) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1. Количество тестов: 50. Среднее время выполнения: 0.005690279006958007 секунд.
4) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 20. Количество тестов: 50. Среднее время выполнения: 0.008287653923034669 секунд.
5) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 500. Количество тестов: 50. Среднее время выполнения: 0.03273001670837403 секунд.
6) Тест: Среднее время записи в хранилище пачки данных. Размер пачки: 1000. Количество тестов: 50. Среднее время выполнения: 0.05435636520385742 секунд.

Подробные результаты с графиками можно посмотреть в директории `/ugc_sprint_1/storages_research/research_results`.

______________________________________
### Вывод
Vertica - платное решение. Сайт вертики недоступен из российского региона без впн. Недостаточно подробная документация.
Низкие скорости для записи значений, по сравнению с clickhouse.
Clickhouse - open-source решение от компании, которая врядли уйдет с российского рынка. Хорошая документация и активное развитие. Высокие скорости для записи значений. 

Ввиду очевидного превосходства по записи и чтению данных в различных вариациях БД ClickHouse
было решено выбрать её для дальнейшей разработки.

MongoDB полностью удовлетворяет требовниям, поставленным перед сервисом, в первую очередь, по выборке записей. В результате проведнного исследования было принято решение выбрать в качестве хранилища MongoDB.